# Subqueries-and-views
CREATE DATABASE SUBQUERY;
USE SUBQUERY;
CREATE TABLE COUNTRY(Id INT PRIMARY KEY, Country_name VARCHAR(30),Population INT NOT NULL,Area VARCHAR(50));
CREATE TABLE PERSONS(Id INT PRIMARY KEY,F_name VARCHAR(30), L_name VARCHAR(30),Population INT,Rating INT CHECK(RATING<=10) ,Country_id INT, Country_name VARCHAR(30));
INSERT INTO COUNTRY VALUES(1,'CANADA',1000000,'ALBERTA');
INSERT INTO COUNTRY VALUES(2,'INDIA',1100000,'DELHI');
INSERT INTO COUNTRY VALUES(3,'CANADA',1200000,'ALBERTASASKATCHEWAN');
INSERT INTO COUNTRY VALUES(4,'USA',800000,'CALIFORNIA');
INSERT INTO COUNTRY VALUES(5,'AFGANISTAN',900000,'KHOST');
INSERT INTO COUNTRY VALUES(6,'BRAZIL',400000,'SALVADOR');
INSERT INTO COUNTRY VALUES(7,'CHILE',2200000,'SANTIAGO');
INSERT INTO COUNTRY VALUES(8,'DENMARK',1800000,'RIBE');
INSERT INTO COUNTRY VALUES(9,'ARGENTINA',5000000,'MENDOZA');
INSERT INTO COUNTRY VALUES(10,'SRILANKA',6000000,'MENOZA');


INSERT INTO PERSONS VALUES(11,'HALEEMA','ANAF',1000000,5,1,'CANADA');
INSERT INTO PERSONS VALUES(12,'AYISHA','BEEGAM',1000000,6,1,'CANADA');
INSERT INTO PERSONS VALUES(13,'NYNA','FASIL',900000,8,5,'AFGANISTAN');
INSERT INTO PERSONS VALUES(14,'MANJU','SUNIL',800000,3,4,'USA');
INSERT INTO PERSONS VALUES(15,'NAYAN','THARA',1100000,9,2,'INDIA');
INSERT INTO PERSONS VALUES(16,'THAS','LEENA',1100000,8,2,'INDIA');
INSERT INTO PERSONS VALUES(17,'NYHA','FAZY',400000,2,6,'BRAZIL');
INSERT INTO PERSONS VALUES(18,'SHERIN','JAHANA',2200000,6,7,'CHILE');
INSERT INTO PERSONS VALUES(19,'JASMIN','MOOSA',400000,5,6,'BRAZIL');
INSERT INTO PERSONS VALUES(20,'PRITHVI','SUKU',1000000,7,8,'DENMARK');
INSERT INTO PERSONS VALUES(21,'ALAN','DAVID',1000000,3,9,'ARGENTINA');
INSERT INTO PERSONS VALUES(22,'RAZIN','RAHMAN',1200000,5,3,'CANADA');
INSERT INTO PERSONS VALUES(23,'RAFIN','MUHD',1000000,5,1,'');
INSERT INTO PERSONS VALUES(24,'SHAHANA','SALIM',1000000,5,1,'');
INSERT INTO PERSONS VALUES(25,'LISHA','BIBIN',1000000,5,10,'UK');
INSERT INTO PERSONS VALUES(26,'HIJLA','ILYAS',1000000,5,10,'UK');
INSERT INTO PERSONS VALUES(27,'HIJ','YAS',900000,7.8,10,'UK');
INSERT INTO PERSONS VALUES(28,'JLA','AS',600000,7.3,10,'UK');

ALTER TABLE PERSONS ADD COLUMN AGE INT;

#ADD A NEW COLUMN CALLED DOB IN PERSONS TABLE WITH DATATYPE AS DATE
ALTER TABLE PERSONS ADD COLUMN DOB DATE;
UPDATE PERSONS SET DOB='1990-01-20' WHERE Id=11;
UPDATE PERSONS SET DOB='1991-02-22' WHERE Id=12;
UPDATE PERSONS SET DOB='1992-03-2' WHERE Id=13;
UPDATE PERSONS SET DOB='1993-04-27' WHERE Id=14;
UPDATE PERSONS SET DOB='1994-06-5' WHERE Id=15;
UPDATE PERSONS SET DOB='1995-07-10' WHERE Id=16;
UPDATE PERSONS SET DOB='1996-08-30' WHERE Id=17;
UPDATE PERSONS SET DOB='1993-01-20' WHERE Id=18;
UPDATE PERSONS SET DOB='1994-08-20' WHERE Id=19;
UPDATE PERSONS SET DOB='1999-09-11' WHERE Id=20;
UPDATE PERSONS SET DOB='1980-01-12' WHERE Id=21;
UPDATE PERSONS SET DOB='1982-09-13' WHERE Id=22;
UPDATE PERSONS SET DOB='1984-10-20' WHERE Id=23;
UPDATE PERSONS SET DOB='1985-11-11' WHERE Id=24;
UPDATE PERSONS SET DOB='1986-12-12' WHERE Id=25;
UPDATE PERSONS SET DOB='1987-08-13' WHERE Id=26;
UPDATE PERSONS SET DOB='1988-01-20' WHERE Id=27;
UPDATE PERSONS SET DOB='1989-03-03' WHERE Id=28;
SELECT * FROM PERSONS;


#find the number of persons in each country
SELECT Country_name, COUNT(*) AS NUMBER FROM PERSONS GROUP BY Country_name;

#find the number of persons from each country sorted from high to low
SELECT Country_name, COUNT(*) AS NUMBER FROM PERSONS GROUP BY Country_name ORDER BY NUMBER DESC;

#FIND OUT AN AVERAGE RATING FOR PERONS IN RESPECTIVE COUNTRIES IF THE AVERGE IS GREATER THAN 3
SELECT Country_name,AVG(Rating) as avg_rating FROM PERSONS GROUP BY Country_name having avg(Rating)>3;

#find the countries with same rating as USA
SELECT Country_name FROM PERSONS WHERE Rating = (SELECT Rating FROM PERSONS WHERE Country_name='USA');

#SELECT ALL COUNTRIES WHOSE POPULATION IS GREATER THAN THE AVG POPULATION OF ALL COUNTRIES
SELECT Country_name from persons where population>(select avg(population) from persons) group by Country_name;




CREATE DATABASE PRODUCT;
USE PRODUCT;
CREATE TABLE CUSTOMER(Customer_id INT PRIMARY KEY,F_name VARCHAR(30), L_name VARCHAR(30),Email VARCHAR(50),Phone_num VARCHAR(10),ADDRESS VARCHAR(100),CITY VARCHAR(30),STATE VARCHAR(30),ZIPCODE VARCHAR(10),COUNTRY VARCHAR(30));
INSERT INTO CUSTOMER VALUES (1,'AYSHA','BEEGAM','AYSHA@GMAIL.COM','9961116616','LOVELY HOUSE','KOZHIKODE','KERALA','673574','INDIA');
INSERT INTO CUSTOMER VALUES (2,'NYNA','FASIL','NYNA@GMAIL.COM','9961119999','super HOUSE','maplappuram','Karnataka','673575','INDIA');
INSERT INTO CUSTOMER VALUES (3,'NYHA','FAZY','NYHA@GMAIL.COM','99611111111','sweet HOUSE','Kannur','KERALA','goa','123456','CHINA');
INSERT INTO CUSTOMER VALUES (4,'SHAHANA','SALIM','SHAHANA@GMAIL.COM','9961112222','my HOUSE','waynad','maharashtra','673576','MALASIA');
INSERT INTO CUSTOMER VALUES (5,'THASLEENA','THAS','THAS@GMAIL.COM','9961113333','thas HOUSE','kasargode','punjab','673577','SINGAPORE');
INSERT INTO CUSTOMER VALUES (6,'HALEEMA','HAL','HALEEMA@GMAIL.COM','9961114444','hal HOUSE','idukki','hariyana','673578','USA');
INSERT INTO CUSTOMER VALUES (7,'shibin','das','shibi@GMAIL.COM','9961115555','shibin HOUSE','alappuzha','tamil nadu','673579','CANADA');
INSERT INTO CUSTOMER VALUES (8,'aleena','maam','Aleena@GMAIL.COM','9961116666','aleen HOUSE','thrissur','sikkim','673580','CHILE');
INSERT INTO CUSTOMER VALUES (9,'thara','nine','thara@GMAIL.COM','9961117777','thara HOUSE','ernakulam','rajasthan','673581','CHINA');
INSERT INTO CUSTOMER VALUES (10,'thas','niya','thasniya@GMAIL.COM','9961118888','niya HOUSE','palakkad','west bengal','673582','CANADA');
INSERT INTO CUSTOMER VALUES (12,'surayya','mhmd','sura@GMAIL.COM','9961110000','sura HOUSE','pathanamthitta','madhya pradesh','673587','ARGENTINA');
INSERT INTO CUSTOMER VALUES (13,'surayy','mhmd','sura@GMAIL.COM','9961110000','sura HOUSE','pathanamthitta','madhya pradesh','673587','ARGENTINA');
INSERT INTO CUSTOMER VALUES (14,'suray','mhmd','sura@GMAIL.COM','9961110000','sura HOUSE','pathanamthitta','madhya pradesh','673587','ARGENTINA');
INSERT INTO CUSTOMER VALUES (15,'sura','mhmd','sura@GMAIL.COM','9961110000','sura HOUSE','pathanamthitta','madhya pradesh','673587','ARGENTINA');
INSERT INTO CUSTOMER VALUES (16,'sur','mhmd','sura@GMAIL.COM','9961110000','sura HOUSE','pathanamthitta','madhya pradesh','673587','ARGENTINA');
INSERT INTO CUSTOMER VALUES (17,'su','mhmd','sura@GMAIL.COM','9961110000','sura HOUSE','pathanamthitta','madhya pradesh','673587','ARGENTINA');


SELECT * FROM CUSTOMER;

#create view named customer_info for the customer table that displays customer's full name and email id then perform the select operation for the customer info view
CREATE VIEW Customer_info AS SELECT CONCAT(F_name,' ',L_name) as NAME,Email FROM CUSTOMER;
SELECT * FROM Customer_info;

#create a view named us_customers that displays customers located in the US 
CREATE VIEW US_customers AS SELECT F_name FROM CUSTOMER WHERE COUNTRY='USA';
SELECT * FROM US_customers;

#create another view named customer_details with columns full name(combine first name and last name),email,phone no,and state
CREATE VIEW Customer_details AS SELECT CONCAT(F_name,' ',L_name) AS NAME,  Email, Phone_num, STATE FROM CUSTOMER;
SELECT * FROM Customer_details;

#update phone numbers of customers who live in california for customer_details view
UPDATE Customer_details SET Phone_num='1234987066' where STATE ='west bengal';

#COUNT THE NUMBER OF CUSTOMERS IN EACH STATE AND SHOW ONLY STATES WITH MORE THAN 5 CUSTOMERS
SELECT COUNT(Customer_id),COUNTRY FROM CUSTOMER GROUP BY COUNTRY HAVING COUNT(COUNTRY)>5;

#WRITE A QUERY THAT WILL RETURN THE NUMBER OF CUSTOMERS IN EACH STATE BASED ON THE STATE COLUMN IN THE CUSTOMER_DETAILS VIEW
SELECT COUNT(NAME),STATE FROM Customer_details GROUP BY STATE;

#WRITE A QUERY THAT RETURNS ALL THE COLUMNS FROM THE CUSTOMER_DETAILS VIEW SORTED BY THE STATE COLUMN IN ASCENDING ORDER
SELECT * FROM Customer_details ORDER BY STATE ASC;
